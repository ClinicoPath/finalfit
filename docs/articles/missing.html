<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Missing data • finalfit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Missing data">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">finalfit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/finalfit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/all_tables_examples.html">All tables examples</a>
    </li>
    <li>
      <a href="../articles/bootstrap.html">Bootstrap simulation for model prediction</a>
    </li>
    <li>
      <a href="../articles/data_prep.html">Preparing data for finalfit</a>
    </li>
    <li>
      <a href="../articles/export.html">Exporting tables and plots</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Time-to-event (Survival)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ewenharrison/finalfit">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Missing data</h1>
                        <h4 class="author">Ewen Harrison</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ewenharrison/finalfit/blob/master/vignettes/missing.Rmd"><code>vignettes/missing.Rmd</code></a></small>
      <div class="hidden name"><code>missing.Rmd</code></div>

    </div>

    
    
<p>As a journal editor, I often receive studies in which the investigators fail to describe, analyse, or even acknowledge missing data. This is frustrating, as it is often of the utmost importance. Conclusions may (and do) change when missing data is accounted for. A few seem to not even appreciate that in conventional regression, only rows with complete data are included.</p>
<p>These are the five steps to ensuring missing data are correctly identified and appropriately dealt with:</p>
<ol style="list-style-type: decimal">
<li>Ensure your data are coded correctly.</li>
<li>Identify missing values within each variable.</li>
<li>Look for patterns of missingness.</li>
<li>Check for associations between missing and observed data.</li>
<li>Decide how to handle missing data.</li>
</ol>
<p><code>finalfit</code> includes a number of functions to help with this.</p>
<div id="some-confusing-terminology" class="section level2">
<h2 class="hasAnchor">
<a href="#some-confusing-terminology" class="anchor"></a>Some confusing terminology</h2>
<p>But first there are some terms which easy to mix up. These are important as they describe the mechanism of missingness and this determines how you can handle the missing data.</p>
<div id="missing-completely-at-random-mcar" class="section level3">
<h3 class="hasAnchor">
<a href="#missing-completely-at-random-mcar" class="anchor"></a>Missing completely at random (MCAR)</h3>
<p>As it says, values are randomly missing from your dataset. Missing data values do not relate to any other data in the dataset and there is no pattern to the actual values of the missing data themselves.</p>
<p>For instance, when smoking status is not recorded in a random subset of patients.</p>
<p>This is easy to handle, but unfortunately, data are almost never missing completely at random.</p>
</div>
<div id="missing-at-random-mar" class="section level3">
<h3 class="hasAnchor">
<a href="#missing-at-random-mar" class="anchor"></a>Missing at random (MAR)</h3>
<p>This is confusing and would be better stated as missing conditionally at random. Here, missing data do have a relationship with other variables in the dataset. However, the actual values that are missing are random.</p>
<p>For example, smoking status is not documented in female patients because the doctor was too shy to ask. Yes ok, not that realistic!</p>
</div>
<div id="missing-not-at-random-mnar" class="section level3">
<h3 class="hasAnchor">
<a href="#missing-not-at-random-mnar" class="anchor"></a>Missing not at random (MNAR)</h3>
<p>The pattern of missingness is related to other variables in the dataset, but in addition, the values of the missing data are not random.</p>
<p>For example, when smoking status is not recorded in patients admitted as an emergency, who are also more likely to have worse outcomes from surgery.</p>
<p>Missing not at random data are important, can alter your conclusions, and are the most difficult to diagnose and handle. They can only be detected by collecting and examining some of the missing data. This is often difficult or impossible to do.</p>
<p>How you deal with missing data is dependent on the type of missingness. Once you know this, then you can sort it.</p>
<p>More on this below.</p>
</div>
</div>
<div id="ensure-your-data-are-coded-correctly-ff_glimpse" class="section level2">
<h2 class="hasAnchor">
<a href="#ensure-your-data-are-coded-correctly-ff_glimpse" class="anchor"></a>1. Ensure your data are coded correctly: <code>ff_glimpse</code>
</h2>
<p>While clearly obvious, this step is often ignored in the rush to get results. The first step in any analysis is robust data cleaning and coding. Lots of packages have a glimpse-type function and <code>finalfit</code> is no different. This function has three specific goals:</p>
<ol style="list-style-type: decimal">
<li>Ensure all factors and numerics are correctly assigned. That is the commonest reason to get an error with a finalfit function. You think you’re using a factor variable, but in fact it is incorrectly coded as a continuous numeric.</li>
<li>Ensure you know which variables have missing data. This presumes missing values are correctly assigned NA. See here for more details if you are unsure.</li>
<li>Ensure factor levels and variable labels are assigned correctly.</li>
</ol>
<div id="example-scenario" class="section level3">
<h3 class="hasAnchor">
<a href="#example-scenario" class="anchor"></a>Example scenario</h3>
<p>Using the <code>colon_s</code> cancer dataset that comes with <code>finalfit</code>, we are interested in exploring the association between a cancer obstructing the bowel and 5-year survival, accounting for other patient and disease characteristics.</p>
<p>For demonstration purposes, we will create random MCAR and MAR smoking variables to the dataset.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Make sure finalfit is up-to-date </span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"finalfit"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(finalfit) </span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># Create some extra missing data</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">## Smoking missing completely at random</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>colon_s<span class="op">$</span>smoking_mcar =<span class="st"> </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Smoker"</span>, <span class="st">"Non-smoker"</span>, <span class="ot">NA</span>), </span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(colon_s)[<span class="dv">1</span>], <span class="dt">replace=</span><span class="ot">TRUE</span>, </span>
<span id="cb2-9"><a href="#cb2-9"></a>    <span class="dt">prob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="st">    </span><span class="kw"><a href="../reference/ff_label.html">ff_label</a></span>(<span class="st">"Smoking (MCAR)"</span>)</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">## Smoking missing conditional on patient sex</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>colon_s<span class="op">$</span>smoking_mar[colon_s<span class="op">$</span>sex.factor <span class="op">==</span><span class="st"> "Female"</span>] =<span class="st"> </span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Smoker"</span>, <span class="st">"Non-smoker"</span>, <span class="ot">NA</span>), </span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(colon_s<span class="op">$</span>sex.factor <span class="op">==</span><span class="st"> "Female"</span>), </span>
<span id="cb2-17"><a href="#cb2-17"></a>    <span class="dt">replace =</span> <span class="ot">TRUE</span>,</span>
<span id="cb2-18"><a href="#cb2-18"></a>    <span class="dt">prob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>))</span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a>colon_s<span class="op">$</span>smoking_mar[colon_s<span class="op">$</span>sex.factor <span class="op">==</span><span class="st"> "Male"</span>] =<span class="st"> </span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Smoker"</span>, <span class="st">"Non-smoker"</span>, <span class="ot">NA</span>), </span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(colon_s<span class="op">$</span>sex.factor <span class="op">==</span><span class="st"> "Male"</span>), </span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.15</span>, <span class="fl">0.75</span>, <span class="fl">0.1</span>))</span>
<span id="cb2-24"><a href="#cb2-24"></a>colon_s<span class="op">$</span>smoking_mar =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(colon_s<span class="op">$</span>smoking_mar) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="st">    </span><span class="kw"><a href="../reference/ff_label.html">ff_label</a></span>(<span class="st">"Smoking (MAR)"</span>)</span>
<span id="cb2-26"><a href="#cb2-26"></a></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co"># Examine with ff_glimpse</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb2-29"><a href="#cb2-29"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>,  </span>
<span id="cb2-30"><a href="#cb2-30"></a>  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span>)</span>
<span id="cb2-31"><a href="#cb2-31"></a>dependent =<span class="st"> "mort_5yr"</span></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_glimpse.html">ff_glimpse</a></span>(dependent, explanatory)</span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">#&gt; $Continuous</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">#&gt;             label var_type   n missing_n missing_percent mean   sd  min</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">#&gt; age   Age (years)    &lt;dbl&gt; 929         0             0.0 59.8 11.9 18.0</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt; nodes       nodes    &lt;dbl&gt; 911        18             1.9  3.7  3.6  0.0</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt;       quartile_25 median quartile_75  max</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt; age          53.0   61.0        69.0 85.0</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt; nodes         1.0    2.0         5.0 33.0</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">#&gt; </span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="co">#&gt; $Categorical</span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">#&gt;                            label var_type   n missing_n missing_percent</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="co">#&gt; mort_5yr        Mortality 5 year    &lt;fct&gt; 915        14             1.5</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">#&gt; sex.factor                   Sex    &lt;fct&gt; 929         0             0.0</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="co">#&gt; obstruct.factor      Obstruction    &lt;fct&gt; 908        21             2.3</span></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="co">#&gt; smoking_mcar      Smoking (MCAR)    &lt;fct&gt; 828       101            10.9</span></span>
<span id="cb2-49"><a href="#cb2-49"></a><span class="co">#&gt; smoking_mar        Smoking (MAR)    &lt;fct&gt; 719       210            22.6</span></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="co">#&gt;                 levels_n                              levels  levels_count</span></span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="co">#&gt; mort_5yr               2        "Alive", "Died", "(Missing)"  511, 404, 14</span></span>
<span id="cb2-52"><a href="#cb2-52"></a><span class="co">#&gt; sex.factor             2                    "Female", "Male"      445, 484</span></span>
<span id="cb2-53"><a href="#cb2-53"></a><span class="co">#&gt; obstruct.factor        2            "No", "Yes", "(Missing)"  732, 176, 21</span></span>
<span id="cb2-54"><a href="#cb2-54"></a><span class="co">#&gt; smoking_mcar           2 "Non-smoker", "Smoker", "(Missing)" 645, 183, 101</span></span>
<span id="cb2-55"><a href="#cb2-55"></a><span class="co">#&gt; smoking_mar            2 "Non-smoker", "Smoker", "(Missing)" 591, 128, 210</span></span>
<span id="cb2-56"><a href="#cb2-56"></a><span class="co">#&gt;                   levels_percent</span></span>
<span id="cb2-57"><a href="#cb2-57"></a><span class="co">#&gt; mort_5yr        55.0, 43.5,  1.5</span></span>
<span id="cb2-58"><a href="#cb2-58"></a><span class="co">#&gt; sex.factor                48, 52</span></span>
<span id="cb2-59"><a href="#cb2-59"></a><span class="co">#&gt; obstruct.factor 78.8, 18.9,  2.3</span></span>
<span id="cb2-60"><a href="#cb2-60"></a><span class="co">#&gt; smoking_mcar          69, 20, 11</span></span>
<span id="cb2-61"><a href="#cb2-61"></a><span class="co">#&gt; smoking_mar           64, 14, 23</span></span></code></pre></div>
<p>The function summarises a data frame or tibble by numeric (continuous) variables and factor (discrete) variables. The dependent and explanatory are for convenience. Pass either or neither e.g. to summarise data frame or tibble:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>colon_s <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_glimpse.html">ff_glimpse</a></span>()</span></code></pre></div>
<p>It doesn’t present well if you have factors with lots of levels, so you may want to remove these.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>hospital) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_glimpse.html">ff_glimpse</a></span>()</span></code></pre></div>
<p>Use this to check that the variables are all assigned and behaving as expected. The proportion of missing data can be seen, e.g. smoking_mar has 23% missing data.</p>
</div>
</div>
<div id="identify-missing-values-in-each-variable-missing_plot" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-missing-values-in-each-variable-missing_plot" class="anchor"></a>2. Identify missing values in each variable: <code>missing_plot</code>
</h2>
<p>In detecting patterns of missingness, this plot is useful. Row number is on the x-axis and all included variables are on the y-axis. Associations between missingness and observations can be easily seen, as can relationships of missingness between variables.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>colon_s <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw"><a href="../reference/missing_plot.html">missing_plot</a></span>()</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/missing_values-1024x312.png"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/missing_values-1024x312.png" alt="" width="700"></a></p>
<p>It was only when writing this post that I discovered the amazing package, <a href="https://naniar.njtierney.com/">naniar</a>. This package is recommended and provides lots of great visualisations for missing data.</p>
</div>
<div id="look-for-patterns-of-missingness-missing_pattern" class="section level2">
<h2 class="hasAnchor">
<a href="#look-for-patterns-of-missingness-missing_pattern" class="anchor"></a>3. Look for patterns of missingness: <code>missing_pattern</code>
</h2>
<p><code>missing_pattern</code> simply wraps <code><a href="https://rdrr.io/pkg/mice/man/md.pattern.html">mice::md.pattern</a></code> using <code>finalfit</code> grammar. This produces a table and a plot showing the pattern of missingness between variables.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="st">"obstruct.factor"</span>,  </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>dependent =<span class="st"> "mort_5yr"</span></span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="st">  </span><span class="kw"><a href="../reference/missing_pattern.html">missing_pattern</a></span>(dependent, explanatory)</span></code></pre></div>
<p><img src="missing_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<pre><code>#&gt;     age sex.factor mort_5yr obstruct.factor smoking_mcar smoking_mar    
#&gt; 617   1          1        1               1            1           1   0
#&gt; 181   1          1        1               1            1           0   1
#&gt; 74    1          1        1               1            0           1   1
#&gt; 22    1          1        1               1            0           0   2
#&gt; 16    1          1        1               0            1           1   1
#&gt; 2     1          1        1               0            1           0   2
#&gt; 2     1          1        1               0            0           1   2
#&gt; 1     1          1        1               0            0           0   3
#&gt; 8     1          1        0               1            1           1   1
#&gt; 4     1          1        0               1            1           0   2
#&gt; 2     1          1        0               1            0           1   2
#&gt;       0          0       14              21          101         210 346</code></pre>
<p>This allows us to look for patterns of missingness between variables. There are 14 patterns in this data. The number and pattern of missingness help us to determine the likelihood of it being random rather than systematic.</p>
<div id="make-sure-you-include-missing-data-in-demographics-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#make-sure-you-include-missing-data-in-demographics-tables" class="anchor"></a>Make sure you include missing data in demographics tables</h3>
<p>Table 1 in a healthcare study is often a demographics table of an “explanatory variable of interest” against other explanatory variables/confounders. Do not silently drop missing values in this table. It is easy to do this correctly with summary_factorlist. This function provides a useful summary of a dependent variable against explanatory variables. Despite its name, continuous variables are handled nicely.</p>
<p><code>na_include=TRUE</code> ensures missing data from the explanatory variables (but not dependent) are included. Note that any p-values are generated across missing groups as well, so run a second time with <code>na_include=FALSE</code> if you wish a hypothesis test only over observed data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Explanatory or confounding variables</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="st">"nodes"</span>,  </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># Explanatory variable of interest</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>dependent =<span class="st"> "obstruct.factor"</span> <span class="co"># Bowel obstruction</span></span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="st">  </span><span class="kw"><a href="../reference/summary_factorlist.html">summary_factorlist</a></span>(dependent, explanatory, </span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="dt">na_include=</span><span class="ot">TRUE</span>, <span class="dt">p=</span><span class="ot">TRUE</span>)</span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; Note: dependent includes missing data. These are dropped.</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;           label     levels          No         Yes     p</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;     Age (years)  Mean (SD) 60.2 (11.5) 57.3 (13.3) 0.004</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;             Sex     Female  346 (47.3)   91 (51.7) 0.330</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt;                       Male  386 (52.7)   85 (48.3)      </span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;           nodes  Mean (SD)   3.7 (3.7)   3.5 (3.2) 0.435</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt;  Smoking (MCAR) Non-smoker  500 (68.3)  130 (73.9) 0.080</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt;                     Smoker  154 (21.0)   26 (14.8)      </span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">#&gt;                  (Missing)   78 (10.7)   20 (11.4)      </span></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co">#&gt;   Smoking (MAR) Non-smoker  467 (63.8)  110 (62.5) 0.077</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co">#&gt;                     Smoker   91 (12.4)   33 (18.8)      </span></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co">#&gt;                  (Missing)  174 (23.8)   33 (18.8)</span></span></code></pre></div>
</div>
</div>
<div id="check-for-associations-between-missing-and-observed-data-missing_pairs-missing_compare" class="section level2">
<h2 class="hasAnchor">
<a href="#check-for-associations-between-missing-and-observed-data-missing_pairs-missing_compare" class="anchor"></a>4. Check for associations between missing and observed data: <code>missing_pairs</code> | <code>missing_compare</code>
</h2>
<p>In deciding whether data is MCAR or MAR, one approach is to explore patterns of missingness between levels of included variables. This is particularly important (I would say absolutely required) for a primary outcome measure / dependent variable.</p>
<p>Take for example “death”. When that outcome is missing it is often for a particular reason. For example, perhaps patients undergoing emergency surgery were less likely to have complete records compared with those undergoing planned surgery. And of course, death is more likely after emergency surgery.</p>
<p><code>missing_pairs</code> uses functions from the excellent <a href="https://ggobi.github.io/ggally/">GGally</a> package. It produces pairs plots to show relationships between missing values and observed values in all variables.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>,  </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="st">"smoking_mcar"</span>, <span class="st">"smoking_mar"</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>dependent =<span class="st"> "mort_5yr"</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">  </span><span class="kw"><a href="../reference/missing_pairs.html">missing_pairs</a></span>(dependent, explanatory)</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs1-1024x775.png"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs1-1024x775.png" alt="" width="700"></a></p>
<p>For continuous variables (age and nodes), the distributions of observed and missing data can be visually compared. Is there a difference between age and mortality above?</p>
<p>For discrete, data, counts are presented by default. It is often easier to compare proportions:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span><span class="kw"><a href="../reference/missing_pairs.html">missing_pairs</a></span>(dependent, explanatory, <span class="dt">position =</span> <span class="st">"fill"</span>, )</span></code></pre></div>
<p><a href="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs2-1-1024x733.png"><img src="https://www.datasurg.net/wp-content/uploads/2018/07/missing_pairs2-1-1024x733.png" alt="" width="700"></a></p>
<p>It should be obvious that missingness in Smoking (MCAR) does not relate to sex (row 6, column 3). But missingness in Smoking (MAR) does differ by sex (last row, column 3) as was designed above when the missing data were created.</p>
<p>We can confirm this using <code>missing_compare</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a>dependent =<span class="st"> "smoking_mcar"</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw"><a href="../reference/missing_compare.html">missing_compare</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">    </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">row.names=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="co"># Omit when you run</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Missing data analysis: Smoking (MCAR)</th>
<th></th>
<th align="right">Not missing</th>
<th align="right">Missing</th>
<th align="right">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td>Mean (SD)</td>
<td align="right">59.7 (11.9)</td>
<td align="right">59.9 (12.6)</td>
<td align="right">0.882</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td>Female</td>
<td align="right">399 (89.7)</td>
<td align="right">46 (10.3)</td>
<td align="right">0.692</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Male</td>
<td align="right">429 (88.6)</td>
<td align="right">55 (11.4)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td>Mean (SD)</td>
<td align="right">3.6 (3.4)</td>
<td align="right">4.0 (4.5)</td>
<td align="right">0.302</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td>No</td>
<td align="right">654 (89.3)</td>
<td align="right">78 (10.7)</td>
<td align="right">0.891</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Yes</td>
<td align="right">156 (88.6)</td>
<td align="right">20 (11.4)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>dependent =<span class="st"> "smoking_mar"</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw"><a href="../reference/missing_compare.html">missing_compare</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="st">    </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">row.names=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="co"># Omit when you run</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Missing data analysis: Smoking (MAR)</th>
<th></th>
<th align="right">Not missing</th>
<th align="right">Missing</th>
<th align="right">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td>Mean (SD)</td>
<td align="right">59.6 (11.9)</td>
<td align="right">60.1 (12.0)</td>
<td align="right">0.597</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td>Female</td>
<td align="right">288 (64.7)</td>
<td align="right">157 (35.3)</td>
<td align="right">&lt;0.001</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Male</td>
<td align="right">431 (89.0)</td>
<td align="right">53 (11.0)</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td>Mean (SD)</td>
<td align="right">3.6 (3.6)</td>
<td align="right">3.8 (3.6)</td>
<td align="right">0.645</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td>No</td>
<td align="right">558 (76.2)</td>
<td align="right">174 (23.8)</td>
<td align="right">0.185</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Yes</td>
<td align="right">143 (81.2)</td>
<td align="right">33 (18.8)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>It takes <code>dependent</code> and <code>explanatory</code> variables, but in this context <code>dependent</code> just refers to the variable being tested for missingness against the <code>explanatory</code> variables.</p>
<p>Comparisons for continuous data use a Kruskal Wallis and for discrete data a chi-squared test.</p>
<p>As expected, a relationship is seen between Sex and Smoking (MAR) but not Smoking (MCAR).</p>
<div id="for-those-who-like-an-omnibus-test" class="section level3">
<h3 class="hasAnchor">
<a href="#for-those-who-like-an-omnibus-test" class="anchor"></a>For those who like an omnibus test</h3>
<p>If you are work predominately with numeric rather than discrete data (categorical/factors), you may find these tests from the MissMech package useful. The package and output is well documented, and provides two tests which can be used to determine whether data are MCAR.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(finalfit)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(MissMech)</span>
<span id="cb13-4"><a href="#cb13-4"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"nodes"</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a>dependent =<span class="st"> "mort_5yr"</span> </span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="st">  </span>MissMech<span class="op">::</span><span class="kw">TestMCARNormality</span>()</span></code></pre></div>
</div>
</div>
<div id="decide-how-to-handle-missing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#decide-how-to-handle-missing-data" class="anchor"></a>5. Decide how to handle missing data</h2>
<p>These <a href="https://www.theanalysisfactor.com/missing-data-mechanism/">pages</a> from Karen Grace-Martin are great for this.</p>
<p>Prior to a standard regression analysis, we can either:</p>
<ul>
<li>Delete the variable with the missing data</li>
<li>Delete the cases with the missing data</li>
<li>Impute (fill in) the missing data</li>
<li>Model the missing data</li>
</ul>
</div>
<div id="mcar-mar-or-mnar" class="section level2">
<h2 class="hasAnchor">
<a href="#mcar-mar-or-mnar" class="anchor"></a>MCAR, MAR, or MNAR</h2>
<div id="mcar-vs-mar" class="section level3">
<h3 class="hasAnchor">
<a href="#mcar-vs-mar" class="anchor"></a><strong>MCAR</strong> vs MAR</h3>
<p>Using the examples, we identify that Smoking (MCAR) is missing completely at random.</p>
<p>We know nothing about the missing values themselves, but we know of no plausible reason that the values of the missing data, for say, people who died should be different to the values of the missing data for those who survived. The pattern of missingness is therefore not felt to be MNAR.</p>
<div id="common-solution" class="section level4">
<h4 class="hasAnchor">
<a href="#common-solution" class="anchor"></a>Common solution</h4>
<p>Depending on the number of data points that are missing, we may have sufficient power with complete cases to examine the relationships of interest.</p>
<p>We therefore elect to simply omit the patients in whom smoking is missing. This is known as list-wise deletion and will be performed by default in standard regression analyses including <code>finalfit</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>,  </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="st">"smoking_mcar"</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>dependent =<span class="st"> "mort_5yr"</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="st">    </span><span class="kw"><a href="../reference/finalfit.html">finalfit</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="st">    </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">row.names=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>)) <span class="co"># Omit when you run</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; Note: dependent includes missing data. These are dropped.</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt; Waiting for profiling to be done...</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt; Waiting for profiling to be done...</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt; Waiting for profiling to be done...</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt; Waiting for profiling to be done...</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt; Waiting for profiling to be done...</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt; Waiting for profiling to be done...</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Dependent: Mortality 5 year</th>
<th></th>
<th align="right">Alive</th>
<th align="right">Died</th>
<th align="right">OR (univariable)</th>
<th align="right">OR (multivariable)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td>Mean (SD)</td>
<td align="right">59.8 (11.4)</td>
<td align="right">59.9 (12.5)</td>
<td align="right">1.00 (0.99-1.01, p=0.986)</td>
<td align="right">1.01 (1.00-1.02, p=0.200)</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td>Female</td>
<td align="right">243 (55.6)</td>
<td align="right">194 (44.4)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Male</td>
<td align="right">268 (56.1)</td>
<td align="right">210 (43.9)</td>
<td align="right">0.98 (0.76-1.27, p=0.889)</td>
<td align="right">1.02 (0.76-1.38, p=0.872)</td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td>Mean (SD)</td>
<td align="right">2.7 (2.4)</td>
<td align="right">4.9 (4.4)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
<td align="right">1.25 (1.18-1.33, p&lt;0.001)</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td>No</td>
<td align="right">408 (56.7)</td>
<td align="right">312 (43.3)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Yes</td>
<td align="right">89 (51.1)</td>
<td align="right">85 (48.9)</td>
<td align="right">1.25 (0.90-1.74, p=0.189)</td>
<td align="right">1.53 (1.05-2.22, p=0.027)</td>
</tr>
<tr class="odd">
<td align="left">Smoking (MCAR)</td>
<td>Non-smoker</td>
<td align="right">358 (56.4)</td>
<td align="right">277 (43.6)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Smoker</td>
<td align="right">90 (49.7)</td>
<td align="right">91 (50.3)</td>
<td align="right">1.31 (0.94-1.82, p=0.113)</td>
<td align="right">1.37 (0.96-1.96, p=0.083)</td>
</tr>
</tbody>
</table>
</div>
<div id="other-considerations" class="section level4">
<h4 class="hasAnchor">
<a href="#other-considerations" class="anchor"></a>Other considerations</h4>
<ol style="list-style-type: decimal">
<li>Sensitivity analysis</li>
<li>Omit the variable</li>
<li>Imputation</li>
<li>Model the missing data</li>
</ol>
<p>If the variable in question is thought to be particularly important, you may wish to perform a sensitivity analysis. A sensitivity analysis in this context aims to capture the effect of uncertainty on the conclusions drawn from the model. Thus, you may choose to re-label all missing smoking values as “smoker”, and see if that changes the conclusions of your analysis. The same procedure can be performed labeling with “non-smoker”.</p>
<p>If smoking is not associated with the explanatory variable of interest (bowel obstruction) or the outcome, it may be considered not to be a confounder and so could be omitted. That neatly deals with the missing data issue, but of course may not be appropriate.</p>
<p>Imputation and modelling are considered below.</p>
</div>
</div>
<div id="mcar-vs-mar-1" class="section level3">
<h3 class="hasAnchor">
<a href="#mcar-vs-mar-1" class="anchor"></a>MCAR vs <strong>MAR</strong>
</h3>
<p>But life is rarely that simple.</p>
<p>Consider that the smoking variable is more likely to be missing if the patient is female (missing_compareshows a relationship). But, say, that the missing values are not different from the observed values. Missingness is then MAR.</p>
<p>If we simply drop all the cases (patients) in which smoking is missing (list-wise deletion), then proportionally we drop more females than men. This may have consequences for our conclusions if sex is associated with our explanatory variable of interest or outcome.</p>
<div id="common-solution-1" class="section level4">
<h4 class="hasAnchor">
<a href="#common-solution-1" class="anchor"></a>Common solution</h4>
<p><a href="https://github.com/amices/mice">mice</a> is our go to package for multiple imputation. That’s the process of filling in missing data using a best-estimate from all the other data that exists. When first encountered, this may not sound like a good idea.</p>
<p>However, taking our simple example, if missingness in smoking is predicted strongly by sex (and other observed variables), and the values of the missing data are random, then we can impute (best-guess) the missing smoking values using sex and other variables in the dataset.</p>
<p>Imputation is not usually appropriate for the explanatory variable of interest or the outcome variable. In both case, the hypothesis is that there is an meaningful association with other variables in the dataset, therefore it doesn’t make sense to use these variables to impute them.</p>
<p>Here is some code to run <code>mice</code>. The package is well documented, and there are a number of checks and considerations that should be made to inform the imputation process. Read the documentation carefully prior to doing this yourself.</p>
<p>Note also <code><a href="../reference/missing_predictorMatrix.html">finalfit::missing_predictorMatrix()</a></code>. This provides an easy way to include or exclude variables to be imputed or to be used for imputation.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Multivariate Imputation by Chained Equations (mice)</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(finalfit)</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mice)</span>
<span id="cb15-5"><a href="#cb15-5"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>, <span class="st">"smoking_mar"</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>dependent =<span class="st"> "mort_5yr"</span></span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co"># Choose not to impute missing values</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co"># for explanatory variable of interest and</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co"># outcome variable. </span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co"># But include in algorithm for imputation.</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="st">    </span><span class="kw"><a href="../reference/missing_predictorMatrix.html">missing_predictorMatrix</a></span>(</span>
<span id="cb15-16"><a href="#cb15-16"></a>        <span class="dt">drop_from_imputed =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"obstruct.factor"</span>, <span class="st">"mort_5yr"</span>)</span>
<span id="cb15-17"><a href="#cb15-17"></a>        ) -&gt;<span class="st"> </span>predM</span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a>fits =<span class="st"> </span>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="st">  </span><span class="co"># Usually run imputation with 10 imputed sets, 4 here for demonstration</span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/mice/man/mice.html">mice</a></span>(<span class="dt">m =</span> <span class="dv">4</span>, <span class="dt">predictorMatrix =</span> predM) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="st">  </span><span class="co"># Run logistic regression on each imputed set</span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span>(<span class="kw"><a href="../reference/ff_formula.html">ff_formula</a></span>(dependent, explanatory)), </span>
<span id="cb15-25"><a href="#cb15-25"></a>    <span class="dt">family=</span><span class="st">"binomial"</span>))</span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co">#&gt; </span></span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="co">#&gt;  iter imp variable</span></span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="co">#&gt;   1   1  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="co">#&gt;   1   2  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="co">#&gt;   1   3  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-31"><a href="#cb15-31"></a><span class="co">#&gt;   1   4  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-32"><a href="#cb15-32"></a><span class="co">#&gt;   2   1  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="co">#&gt;   2   2  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-34"><a href="#cb15-34"></a><span class="co">#&gt;   2   3  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-35"><a href="#cb15-35"></a><span class="co">#&gt;   2   4  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-36"><a href="#cb15-36"></a><span class="co">#&gt;   3   1  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-37"><a href="#cb15-37"></a><span class="co">#&gt;   3   2  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-38"><a href="#cb15-38"></a><span class="co">#&gt;   3   3  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-39"><a href="#cb15-39"></a><span class="co">#&gt;   3   4  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-40"><a href="#cb15-40"></a><span class="co">#&gt;   4   1  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-41"><a href="#cb15-41"></a><span class="co">#&gt;   4   2  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-42"><a href="#cb15-42"></a><span class="co">#&gt;   4   3  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-43"><a href="#cb15-43"></a><span class="co">#&gt;   4   4  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-44"><a href="#cb15-44"></a><span class="co">#&gt;   5   1  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-45"><a href="#cb15-45"></a><span class="co">#&gt;   5   2  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-46"><a href="#cb15-46"></a><span class="co">#&gt;   5   3  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-47"><a href="#cb15-47"></a><span class="co">#&gt;   5   4  mort_5yr  nodes  obstruct.factor  smoking_mar</span></span>
<span id="cb15-48"><a href="#cb15-48"></a></span>
<span id="cb15-49"><a href="#cb15-49"></a><span class="co"># Examples of extracting metrics from fits</span></span>
<span id="cb15-50"><a href="#cb15-50"></a><span class="co">## AICs</span></span>
<span id="cb15-51"><a href="#cb15-51"></a>fits <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-52"><a href="#cb15-52"></a><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/mice/man/getfit.html">getfit</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-53"><a href="#cb15-53"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(AIC)</span>
<span id="cb15-54"><a href="#cb15-54"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb15-55"><a href="#cb15-55"></a><span class="co">#&gt; [1] 1191.789</span></span>
<span id="cb15-56"><a href="#cb15-56"></a><span class="co">#&gt; </span></span>
<span id="cb15-57"><a href="#cb15-57"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb15-58"><a href="#cb15-58"></a><span class="co">#&gt; [1] 1199.745</span></span>
<span id="cb15-59"><a href="#cb15-59"></a><span class="co">#&gt; </span></span>
<span id="cb15-60"><a href="#cb15-60"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb15-61"><a href="#cb15-61"></a><span class="co">#&gt; [1] 1195.581</span></span>
<span id="cb15-62"><a href="#cb15-62"></a><span class="co">#&gt; </span></span>
<span id="cb15-63"><a href="#cb15-63"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb15-64"><a href="#cb15-64"></a><span class="co">#&gt; [1] 1188.155</span></span>
<span id="cb15-65"><a href="#cb15-65"></a></span>
<span id="cb15-66"><a href="#cb15-66"></a><span class="co"># C-statistic</span></span>
<span id="cb15-67"><a href="#cb15-67"></a>fits <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-68"><a href="#cb15-68"></a><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/mice/man/getfit.html">getfit</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-69"><a href="#cb15-69"></a><span class="st">    </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="st"> </span>pROC<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span>(.x<span class="op">$</span>y, .x<span class="op">$</span>fitted)<span class="op">$</span>auc)</span>
<span id="cb15-70"><a href="#cb15-70"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb15-71"><a href="#cb15-71"></a><span class="co">#&gt; Area under the curve: 0.6822</span></span>
<span id="cb15-72"><a href="#cb15-72"></a><span class="co">#&gt; </span></span>
<span id="cb15-73"><a href="#cb15-73"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb15-74"><a href="#cb15-74"></a><span class="co">#&gt; Area under the curve: 0.6761</span></span>
<span id="cb15-75"><a href="#cb15-75"></a><span class="co">#&gt; </span></span>
<span id="cb15-76"><a href="#cb15-76"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb15-77"><a href="#cb15-77"></a><span class="co">#&gt; Area under the curve: 0.6779</span></span>
<span id="cb15-78"><a href="#cb15-78"></a><span class="co">#&gt; </span></span>
<span id="cb15-79"><a href="#cb15-79"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb15-80"><a href="#cb15-80"></a><span class="co">#&gt; Area under the curve: 0.6865</span></span>
<span id="cb15-81"><a href="#cb15-81"></a></span>
<span id="cb15-82"><a href="#cb15-82"></a>  </span>
<span id="cb15-83"><a href="#cb15-83"></a><span class="co"># Pool  results</span></span>
<span id="cb15-84"><a href="#cb15-84"></a>fits_pool =<span class="st"> </span>fits <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-85"><a href="#cb15-85"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/mice/man/pool.html">pool</a></span>()</span>
<span id="cb15-86"><a href="#cb15-86"></a></span>
<span id="cb15-87"><a href="#cb15-87"></a><span class="co">## Can be passed to or_plot</span></span>
<span id="cb15-88"><a href="#cb15-88"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-89"><a href="#cb15-89"></a><span class="st">    </span><span class="kw"><a href="../reference/or_plot.html">or_plot</a></span>(dependent, explanatory, <span class="dt">glmfit =</span> fits_pool, <span class="dt">table_text_size=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="missing_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># Summarise and put in table</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>fit_imputed =<span class="st"> </span>fits_pool <span class="op">%&gt;%</span><span class="st">                                  </span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="st">    </span><span class="kw"><a href="../reference/fit2df.html">fit2df</a></span>(<span class="dt">estimate_name =</span> <span class="st">"OR (multiple imputation)"</span>, <span class="dt">exp =</span> <span class="ot">TRUE</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># Use finalfit merge methods to create and compare results</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="st">  </span><span class="kw"><a href="../reference/summary_factorlist.html">summary_factorlist</a></span>(dependent, explanatory, <span class="dt">fit_id =</span> <span class="ot">TRUE</span>) -&gt;<span class="st"> </span>summary1</span>
<span id="cb16-9"><a href="#cb16-9"></a></span>
<span id="cb16-10"><a href="#cb16-10"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="st">  </span><span class="kw"><a href="../reference/glmuni.html">glmuni</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="st">  </span><span class="kw"><a href="../reference/fit2df.html">fit2df</a></span>(<span class="dt">estimate_suffix =</span> <span class="st">" (univariable)"</span>) -&gt;<span class="st"> </span>fit_uni</span>
<span id="cb16-13"><a href="#cb16-13"></a></span>
<span id="cb16-14"><a href="#cb16-14"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="st">  </span><span class="kw"><a href="../reference/glmmulti.html">glmmulti</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="st">  </span><span class="kw"><a href="../reference/fit2df.html">fit2df</a></span>(<span class="dt">estimate_suffix =</span> <span class="st">" (multivariable inc. smoking)"</span>) -&gt;<span class="st"> </span>fit_multi</span>
<span id="cb16-17"><a href="#cb16-17"></a></span>
<span id="cb16-18"><a href="#cb16-18"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb16-19"><a href="#cb16-19"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>)</span>
<span id="cb16-20"><a href="#cb16-20"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="st">  </span><span class="kw"><a href="../reference/glmmulti.html">glmmulti</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="st">  </span><span class="kw"><a href="../reference/fit2df.html">fit2df</a></span>(<span class="dt">estimate_suffix =</span> <span class="st">" (multivariable)"</span>) -&gt;<span class="st"> </span>fit_multi_r</span>
<span id="cb16-23"><a href="#cb16-23"></a></span>
<span id="cb16-24"><a href="#cb16-24"></a><span class="co"># Combine to final table</span></span>
<span id="cb16-25"><a href="#cb16-25"></a>summary1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_merge.html">ff_merge</a></span>(fit_uni) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-27"><a href="#cb16-27"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_merge.html">ff_merge</a></span>(fit_multi_r) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_merge.html">ff_merge</a></span>(fit_multi) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="st">  </span><span class="kw"><a href="../reference/ff_merge.html">ff_merge</a></span>(fit_imputed) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-30"><a href="#cb16-30"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>fit_id, <span class="op">-</span>index) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-31"><a href="#cb16-31"></a><span class="st">    </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">row.names=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>,<span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>))</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">label</th>
<th align="left">levels</th>
<th align="right">Alive</th>
<th align="right">Died</th>
<th align="right">OR (univariable)</th>
<th align="right">OR (multivariable)</th>
<th align="right">OR (multivariable inc. smoking)</th>
<th align="right">OR (multiple imputation)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="right">59.8 (11.4)</td>
<td align="right">59.9 (12.5)</td>
<td align="right">1.00 (0.99-1.01, p=0.986)</td>
<td align="right">1.01 (1.00-1.02, p=0.122)</td>
<td align="right">1.02 (1.00-1.03, p=0.010)</td>
<td align="right">1.01 (1.00-1.02, p=0.235)</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td align="left">Female</td>
<td align="right">243 (47.6)</td>
<td align="right">194 (48.0)</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Male</td>
<td align="right">268 (52.4)</td>
<td align="right">210 (52.0)</td>
<td align="right">0.98 (0.76-1.27, p=0.889)</td>
<td align="right">0.98 (0.74-1.30, p=0.890)</td>
<td align="right">0.88 (0.64-1.23, p=0.461)</td>
<td align="right">1.01 (0.77-1.32, p=0.960)</td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td align="left">Mean (SD)</td>
<td align="right">2.7 (2.4)</td>
<td align="right">4.9 (4.4)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
<td align="right">1.25 (1.19-1.32, p&lt;0.001)</td>
<td align="right">1.25 (1.18-1.33, p&lt;0.001)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td align="left">No</td>
<td align="right">408 (82.1)</td>
<td align="right">312 (78.6)</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Yes</td>
<td align="right">89 (17.9)</td>
<td align="right">85 (21.4)</td>
<td align="right">1.25 (0.90-1.74, p=0.189)</td>
<td align="right">1.36 (0.95-1.93, p=0.089)</td>
<td align="right">1.26 (0.85-1.88, p=0.252)</td>
<td align="right">1.33 (0.92-1.92, p=0.124)</td>
</tr>
<tr class="odd">
<td align="left">Smoking (MAR)</td>
<td align="left">Non-smoker</td>
<td align="right">328 (82.8)</td>
<td align="right">254 (81.2)</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Smoker</td>
<td align="right">68 (17.2)</td>
<td align="right">59 (18.8)</td>
<td align="right">1.12 (0.76-1.65, p=0.563)</td>
<td align="right">-</td>
<td align="right">1.25 (0.82-1.89, p=0.300)</td>
<td align="right">1.23 (0.77-1.96, p=0.364)</td>
</tr>
</tbody>
</table>
<p>The final table can easily be exported to Word or as a PDF as described in the “Export” vignette.</p>
<p>By examining the coefficients, the effect of the imputation compared with the complete case analysis can be clearly seen.</p>
</div>
<div id="other-considerations-1" class="section level4">
<h4 class="hasAnchor">
<a href="#other-considerations-1" class="anchor"></a>Other considerations</h4>
<ol style="list-style-type: decimal">
<li>Omit the variable</li>
<li>Imputing factors with new level for missing data</li>
<li>Model the missing data</li>
</ol>
<p>As above, if the variable does not appear to be important, it may be omitted from the analysis. A sensitivity analysis in this context is another form of imputation. But rather than using all other available information to best-guess the missing data, we simply assign the value as above. Imputation is therefore likely to be more appropriate.</p>
<p>There is an alternative method to model the missing data for the categorical in this setting – just consider the missing data as a factor level. This has the advantage of simplicity, with the disadvantage of increasing the number of terms in the model. Multiple imputation is generally preferred.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2"></a>explanatory =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex.factor"</span>, </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="st">"nodes"</span>, <span class="st">"obstruct.factor"</span>, <span class="st">"smoking_mar"</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a>colon_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="dt">smoking_mar =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na</a></span>(smoking_mar)</span>
<span id="cb17-7"><a href="#cb17-7"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="st">  </span><span class="kw"><a href="../reference/finalfit.html">finalfit</a></span>(dependent, explanatory) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="st">    </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">row.names=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>, <span class="st">"r"</span>))</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Dependent: Mortality 5 year</th>
<th></th>
<th align="right">Alive</th>
<th align="right">Died</th>
<th align="right">OR (univariable)</th>
<th align="right">OR (multivariable)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td>Mean (SD)</td>
<td align="right">59.8 (11.4)</td>
<td align="right">59.9 (12.5)</td>
<td align="right">1.00 (0.99-1.01, p=0.986)</td>
<td align="right">1.01 (1.00-1.02, p=0.119)</td>
</tr>
<tr class="even">
<td align="left">Sex</td>
<td>Female</td>
<td align="right">243 (55.6)</td>
<td align="right">194 (44.4)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Male</td>
<td align="right">268 (56.1)</td>
<td align="right">210 (43.9)</td>
<td align="right">0.98 (0.76-1.27, p=0.889)</td>
<td align="right">0.96 (0.72-1.30, p=0.809)</td>
</tr>
<tr class="even">
<td align="left">nodes</td>
<td>Mean (SD)</td>
<td align="right">2.7 (2.4)</td>
<td align="right">4.9 (4.4)</td>
<td align="right">1.24 (1.18-1.30, p&lt;0.001)</td>
<td align="right">1.25 (1.19-1.32, p&lt;0.001)</td>
</tr>
<tr class="odd">
<td align="left">Obstruction</td>
<td>No</td>
<td align="right">408 (56.7)</td>
<td align="right">312 (43.3)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Yes</td>
<td align="right">89 (51.1)</td>
<td align="right">85 (48.9)</td>
<td align="right">1.25 (0.90-1.74, p=0.189)</td>
<td align="right">1.34 (0.94-1.91, p=0.102)</td>
</tr>
<tr class="odd">
<td align="left">Smoking (MAR)</td>
<td>Non-smoker</td>
<td align="right">328 (56.4)</td>
<td align="right">254 (43.6)</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Smoker</td>
<td align="right">68 (53.5)</td>
<td align="right">59 (46.5)</td>
<td align="right">1.12 (0.76-1.65, p=0.563)</td>
<td align="right">1.24 (0.82-1.88, p=0.308)</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>(Missing)</td>
<td align="right">115 (55.8)</td>
<td align="right">91 (44.2)</td>
<td align="right">1.02 (0.74-1.41, p=0.895)</td>
<td align="right">0.99 (0.69-1.41, p=0.943)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="mnar-vs-mar" class="section level3">
<h3 class="hasAnchor">
<a href="#mnar-vs-mar" class="anchor"></a><strong>MNAR</strong> vs MAR</h3>
<p>Missing not at random data is tough in healthcare. To determine if data are MNAR for definite, we need to know their value in a subset of observations (patients).</p>
<p>Using our example above. Say smoking status is poorly recorded in patients admitted to hospital as an emergency with an obstructing cancer. Obstructing bowel cancers may be larger or their position may make the prognosis worse. Smoking may relate to the aggressiveness of the cancer and may be an independent predictor of prognosis. The missing values for smoking may therefore not be random. Smoking may be more common in the emergency patients and may be more common in those that die.</p>
<p>There is no easy way to handle this. If at all possible, try to get the missing data. Otherwise, take care when drawing conclusions from analyses where data are thought to be missing not at random.</p>
</div>
</div>
<div id="where-to-next" class="section level2">
<h2 class="hasAnchor">
<a href="#where-to-next" class="anchor"></a>Where to next</h2>
<p>We are now doing more in Stan. Missing data can be imputed directly within a Stan model which feels neat. Stan doesn’t yet have the equivalent of <code>NA</code> which makes passing the data block into Stan a bit of a faff.</p>
<p>Alternatively, the missing data can be directly modelled in Stan. Examples are provided in the manual. Again, I haven’t found this that easy to do, but there are a number of Stan developments that will hopefully make this more straightforward in the future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#some-confusing-terminology">Some confusing terminology</a></li>
      <li><a href="#ensure-your-data-are-coded-correctly-ff_glimpse">1. Ensure your data are coded correctly: <code>ff_glimpse</code></a></li>
      <li><a href="#identify-missing-values-in-each-variable-missing_plot">2. Identify missing values in each variable: <code>missing_plot</code></a></li>
      <li><a href="#look-for-patterns-of-missingness-missing_pattern">3. Look for patterns of missingness: <code>missing_pattern</code></a></li>
      <li><a href="#check-for-associations-between-missing-and-observed-data-missing_pairs-missing_compare">4. Check for associations between missing and observed data: <code>missing_pairs</code> | <code>missing_compare</code></a></li>
      <li><a href="#decide-how-to-handle-missing-data">5. Decide how to handle missing data</a></li>
      <li><a href="#mcar-mar-or-mnar">MCAR, MAR, or MNAR</a></li>
      <li><a href="#where-to-next">Where to next</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ewen Harrison, Tom Drake, Riinu Ots.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
